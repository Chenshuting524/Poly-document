
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Guideline for Developers Â· Gitbook Test</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-expandable-chapters/expandable-chapters.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="../FAQ/template.html" />
    
    
    <link rel="prev" href="steps.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        <li class="header">Introduction</li>
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Development</li>
        
        
    
        <li class="chapter " data-level="2.1" data-path="readme.html">
            
                <a href="readme.html">
            
                    
                    Joing the Cross Chain Ecosystem
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.1.1" data-path="scenario.html">
            
                <a href="scenario.html">
            
                    
                    Two Scenarios
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.2" data-path="elements.html">
            
                <a href="elements.html">
            
                    
                    Chain Elements to be Submitted
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.3" data-path="steps.html">
            
                <a href="steps.html">
            
                    
                    Common Steps
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="2.1.4" data-path="guideline.html">
            
                <a href="guideline.html">
            
                    
                    Guideline for Developers
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2.2" data-path="../FAQ/template.html">
            
                <a href="../FAQ/template.html">
            
                    
                    Calling the Cross Chain Smart Contract
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.2.1" data-path="template.md">
            
                <span>
            
                    
                    Chapter1
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2.2" data-path="template.md">
            
                <span>
            
                    
                    Chapter2
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2.3" data-path="template.md">
            
                <span>
            
                    
                    Chapter3
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2.3" data-path="../FAQ/template.html">
            
                <a href="../FAQ/template.html">
            
                    
                    Integrating New Tokens
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.3.1" data-path="template.md">
            
                <span>
            
                    
                    Chapter1
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.3.2" data-path="template.md">
            
                <span>
            
                    
                    Chapter2
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.3.3" data-path="template.md">
            
                <span>
            
                    
                    Chapter3
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2.4" data-path="../FAQ/template.html">
            
                <a href="../FAQ/template.html">
            
                    
                    Integrating Poly Bridge to Websites
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.4.1" data-path="template.md">
            
                <span>
            
                    
                    Chapter1
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.4.2" data-path="template.md">
            
                <span>
            
                    
                    Chapter2
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.4.3" data-path="template.md">
            
                <span>
            
                    
                    Chapter3
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    
        
        <li class="header">Glossary</li>
        
        
    
        <li class="chapter " data-level="3.1" data-path="glossary.html">
            
                <a href="glossary.html">
            
                    
                    Glossary
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">FAQ</li>
        
        
    
        <li class="chapter " data-level="4.1" data-path="../FAQ/template.html">
            
                <a href="../FAQ/template.html">
            
                    
                    Default header1
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >Guideline for Developers</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 align="center" id="guideline-for-developers">Guideline for Developers</h1>


<h2 id="overview">Overview</h2>
<p>This chapter shows the developer how to cooperate with the poly network team to add a chain into the poly cross-chain ecosystem. The functions developers need to implement:</p>
<ul>
<li>Block Header Synchronization Interface Method&#xFF0C; including header sync and the entrance functions.</li>
<li>Handler for handling the cross-chain transaction with Merkle proof.</li>
</ul>
<p>The poly team will accomplish the remaining actions such as smart contract deployment, side chain registration, and relayer setup.</p>
<h2 id="block-header-synchronization">Block Header Synchronization</h2>
<p>To implement cross-chain features for any chain, say Ethereum, there are two kinds of contracts that need to be deployed-</p>
<p>Block header synchronization contract: This contract maintains the record of block headers of the relay chain on this chain. These block headers serve as means to verify cross-chain transactions.</p>
<p>The interface methods that need to be implemented by the respective contracts are as follows:</p>
<h3 id="block-header-synchronization-method-to-be-registered-to-relayer">Block Header Synchronization Method to be registered to relayer</h3>
<table>
<thead>
<tr>
<th>Interface Method</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>SyncGenesisHeader</strong></td>
<td>Synchronizes the relay chain&apos;s genesis block header (or another block header where a change in block generation cycle occurred). The method is called one time only when initializing the side chain. It stores and handles the genesis block header, then fetches the consensus node info of the relay chain; please refer to the <a href="https://github.com/polynetwork/poly/blob/master/native/service/header_sync/bsc/header_sync.go#L59-L116" target="_blank">code</a> for more details.</td>
</tr>
<tr>
<td><strong>SyncBlockHeader</strong></td>
<td>Consistently synchronizes block cycle change and cross-chain transaction block headers from the relay chain; the relayers use this interface method to synchronize block headers, stores, and process block headers, fetches the consensus node info if block generation cycle changes; please refer to the <a href="https://github.com/polynetwork/poly/blob/master/native/service/header_sync/bsc/header_sync.go#L208-L314" target="_blank">code</a> for more details.</td>
</tr>
</tbody>
</table>
<p>Code Example for SyncGenesisHeader <a href="https://github.com/polynetwork/poly/blob/master/native/service/header_sync/bsc/header_sync.go#L59-L116" target="_blank">https://github.com/polynetwork/poly/blob/master/native/service/header_sync/bsc/header_sync.go#L59-L116</a> &#xFF08;&#x52A0;&#x4E0A;&#x8BE6;&#x7EC6;&#x6CE8;&#x91CA;&#xFF09;</p>
<p>Code Example for SyncBlockHeader <a href="https://github.com/polynetwork/poly/blob/master/native/service/header_sync/bsc/header_sync.go#L208-L314" target="_blank">https://github.com/polynetwork/poly/blob/master/native/service/header_sync/bsc/header_sync.go#L208-L314</a> &#xFF08;&#x52A0;&#x4E0A;&#x8BE6;&#x7EC6;&#x6CE8;&#x91CA;&#xFF09;</p>
<h3 id="block-header-synchronization-entrance-method">Block Header Synchronization Entrance Method</h3>
<table>
<thead>
<tr>
<th>Interface Method</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>SyncSideChainGenesisHeader</strong></td>
<td>It is the entrance method for synchronizing the genesis block header of the side chain to poly chain and synchronizing the genesis header of the poly chain to ccm contract of the side chain; please refer to the <a href="https://github.com/polynetwork/poly-io-test/blob/master/cmd/tools/run.go#L1156-L1247" target="_blank">code</a> for more details.</td>
</tr>
<tr>
<td></td>
</tr>
</tbody>
</table>
<p>The Key information for this method:</p>
<ul>
<li>Service provider(endpoint) Url of side chain</li>
<li>Selected genesis block height</li>
<li>validators information for verifying genesis headers, it may exist in header information already or need to be fetched from block headers from other block height</li>
<li>Other parameters that required for the side chain block header verification</li>
</ul>
<p>Code Example <a href="https://github.com/polynetwork/poly-io-test/blob/master/cmd/tools/run.go#L1156-L1247" target="_blank">https://github.com/polynetwork/poly-io-test/blob/master/cmd/tools/run.go#L1156-L1247</a> &#xFF08;&#x52A0;&#x4E0A;&#x8BE6;&#x7EC6;&#x6CE8;&#x91CA;&#xFF09;</p>
<h2 id="cross-chain-management">Cross-Chain Management</h2>
<p>Cross-chain management contract: Every chain can have no more than one management contract. It creates cross-chain transactions that are transferred to the relay chain. All the service contracts that contain the business logic need to communicate with the management contract.</p>
<p>The interface methods that need to be implemented by the respective contracts are as follows:</p>
<h3 id="cross-chain-management">Cross Chain Management</h3>
<table>
<thead>
<tr>
<th>Interface Method</th>
<th style="text-align:left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>MakeDepositProposal</strong></td>
<td style="text-align:left">Creates cross-chain transactions invoked by service contracts. When a cross-chain function is carried out in the logic, a transaction includes a unique chain ID; the transaction is recorded in the Merkle tree. Act as the entrance of verifyFromTx, verifying, storing, and returning MakeTxParam for processing cross-chain steps. Please refer to the <a href="https://github.com/polynetwork/poly/blob/master/native/service/cross_chain_manager/bsc/bsc_handler.go#L50-L73" target="_blank">code</a> for details</td>
</tr>
<tr>
<td><strong>verifyFromTx</strong></td>
<td style="text-align:left">Prepare block header and deserialized proof for verifyMerkleProof, decode the extra data from tx and construct MakeTxParam. Please refer to the <a href="https://github.com/polynetwork/poly/blob/master/native/service/cross_chain_manager/bsc/bsc_handler.go#L75-L121" target="_blank">code</a> for details</td>
</tr>
<tr>
<td><strong>verifyMerkleProof</strong></td>
<td style="text-align:left">Verify the Merkle proof obtained by the relayer generated from the source chain to ensure that all transactions included in this block header have been created and have occurred on the relay chain. Please refer to the <a href="https://github.com/polynetwork/poly/blob/master/native/service/cross_chain_manager/bsc/bsc_handler.go#L149-L222" target="_blank">code</a> for details</td>
</tr>
</tbody>
</table>
<p>Here are the parameters used in methods:</p>
<pre><code class="lang-go">MakeDepositProposal:
Requires:
service *native.NativeService   <span class="hljs-comment">//Native Service that carries values of necessary information of  a cross-chain event</span>
Returns:
<span class="hljs-keyword">type</span> verifyFromTx <span class="hljs-keyword">struct</span> {
    TxHash              []<span class="hljs-keyword">byte</span>    
    CrossChainId        []<span class="hljs-keyword">byte</span>    <span class="hljs-comment">//ChainId of source chain</span>
    FromContractAddress <span class="hljs-keyword">uint64</span>    <span class="hljs-comment">//Cross Chain Management Contarct address of source chain</span>
    ToChainId           <span class="hljs-keyword">string</span>    <span class="hljs-comment">//ChainId of target chain</span>
    ToContractAddress   <span class="hljs-keyword">uint64</span>    <span class="hljs-comment">//Cross Chain Management Contarct address of target chain</span>
    Method              []<span class="hljs-keyword">byte</span>    <span class="hljs-comment">//Unlock or lock</span>
    Args                []<span class="hljs-keyword">byte</span>
}
</code></pre>
<pre><code class="lang-go">verifyFromTx:
Requires:
service               *native.NativeService  
proof                 []<span class="hljs-keyword">byte</span>    <span class="hljs-comment">//the proof to be serialized and verifyed</span>
extra                 []<span class="hljs-keyword">byte</span>    <span class="hljs-comment">//the transaction information that will be used for contructing verifyFromTx</span>
fromChainID           <span class="hljs-keyword">uint64</span>,   <span class="hljs-comment">//ChainId of source chain</span>
height                <span class="hljs-keyword">uint32</span>,   <span class="hljs-comment">//the block height correspoding to current transaction event</span>
sideChain             *side_chain_manager.SideChain <span class="hljs-comment">//source chain information that contains ccm  contract address</span>
Returns:
verifyFromTx
</code></pre>
<pre><code class="lang-go">verifyMerkleProof:
Requires:
blockData             *types.Header <span class="hljs-comment">//the blockheader corresponding to current transaction event  </span>
proof                 []<span class="hljs-keyword">byte</span>    <span class="hljs-comment">//the serilized proof</span>
Returns:
Val                   []<span class="hljs-keyword">byte</span>    <span class="hljs-comment">//the proof result for checking extra before constructing verifyFromTx</span>
</code></pre>
<h2 id="test-module">Test Module</h2>
<p>Implement the function for sending cross-chain transactions to itself using lock proxy.  you can see it in Link to test cross-chain code </p>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="steps.html" class="navigation navigation-prev " aria-label="Previous page: Common Steps">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="../FAQ/template.html" class="navigation navigation-next " aria-label="Next page: Calling the Cross Chain Smart Contract">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Guideline for Developers","level":"2.1.4","depth":2,"next":{"title":"Calling the Cross Chain Smart Contract","level":"2.2","depth":1,"path":"FAQ/template.md","ref":"FAQ/template.md","articles":[{"title":"Chapter1","level":"2.2.1","depth":2,"path":"add_chain/template.md","ref":"add_chain/template.md","articles":[]},{"title":"Chapter2","level":"2.2.2","depth":2,"path":"add_chain/template.md","ref":"add_chain/template.md","articles":[]},{"title":"Chapter3","level":"2.2.3","depth":2,"path":"add_chain/template.md","ref":"add_chain/template.md","articles":[]}]},"previous":{"title":"Common Steps","level":"2.1.3","depth":2,"path":"add_chain/steps.md","ref":"add_chain/steps.md","articles":[]},"dir":"ltr"},"config":{"plugins":["expandable-chapters","livereload"],"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"expandable-chapters":{},"livereload":{},"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"theme":"default","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"title":"Gitbook Test","gitbook":"*","theme-default":{"showLevel":true}},"file":{"path":"add_chain/guideline.md","mtime":"2021-12-20T09:49:09.853Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2021-12-20T09:50:40.137Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-expandable-chapters/expandable-chapters.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-livereload/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

