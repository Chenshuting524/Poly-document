
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Guidelines for Developing · GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        <meta name="author" content="PolyNetwork">
        
        
    
    <link rel="stylesheet" href="../../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-sharing-plus/all.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-sharing-plus/style.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-flexible-linkcard/flexible-linkcard.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-emphasize/plugin.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-flexible-alerts/style.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-lightbox/css/lightbox.min.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-alerts/style.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-expandable-chapters/expandable-chapters.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-tbfed-pagefooter/footer.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-search-pro/search.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-code/plugin.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-prism/prism-okaidia.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-theme-hqbook/theme.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="launch.html" />
    
    
    <link rel="prev" href="readme.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="header-inner">
        <!-- LOGO -->
        <div class="logo">
            <img src="" alt="logo">
        </div>
        <span class="title"></span>

        <!-- Search -->
        
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>


        <!-- Nav -->
        <ul class="header-nav">
            <li>
                <a href="https://poly.network/" target="_blank">Home</a>
            </li><li>
                <a href="https://bridge.poly.network/" target="_blank">Poly Bridge</a>
            </li><li>
                <a href="https://explorer.poly.network/" target="_blank">Poly Explorer</a>
            </li>
        </ul>
    </div>

    <div class="book-summary">
        <!--<div class="book-summary-title">文档目录</div>-->
        
        
        <nav role="navigation">
            


<ul class="summary">
    
    

    

    
        
        <li class="header">Introduction</li>
        
        
    
        <li class="chapter " data-level="1.1" data-path="../../">
            
                <a href="../../">
            
                    
                    About Poly Network
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="../../guideline.html">
            
                <a href="../../guideline.html">
            
                    
                    Guidelines for Reading
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Development</li>
        
        
    
        <li class="chapter " data-level="2.1" data-path="../../new_chain/readme.html">
            
                <a href="../../new_chain/readme.html">
            
                    
                    Connect New Chains
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.1.1" data-path="../../new_chain/relay_chain/relay_chain_development.html">
            
                <a href="../../new_chain/relay_chain/relay_chain_development.html">
            
                    
                    Develop for Relay Chain
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.2" data-path="../../new_chain/side_chain/contracts.html">
            
                <a href="../../new_chain/side_chain/contracts.html">
            
                    
                    Develop for Side Chain
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.3" data-path="../../new_chain/relayer/relayer.html">
            
                <a href="../../new_chain/relayer/relayer.html">
            
                    
                    Develop for Relayer
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.4" data-path="../../new_chain/launch_and_test/launch.html">
            
                <a href="../../new_chain/launch_and_test/launch.html">
            
                    
                    Launch and Testing
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2.2" data-path="../integrate_bridge/readme.html">
            
                <a href="../integrate_bridge/readme.html">
            
                    
                    Build New Bridges
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.2.1" data-path="../integrate_bridge/bridge.html">
            
                <a href="../integrate_bridge/bridge.html">
            
                    
                    Guidelines for Developing
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2.2" data-path="../integrate_bridge/launch.html">
            
                <a href="../integrate_bridge/launch.html">
            
                    
                    Launch and Testing
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2.3" data-path="../integrate_tokens/readme.html">
            
                <a href="../integrate_tokens/readme.html">
            
                    
                    Register New Tokens
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.3.1" data-path="../integrate_tokens/tokens.html">
            
                <a href="../integrate_tokens/tokens.html">
            
                    
                    Tokens Integration
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.3.2" data-path="../integrate_tokens/launch.html">
            
                <a href="../integrate_tokens/launch.html">
            
                    
                    Launch and Testing
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2.4" data-path="readme.html">
            
                <a href="readme.html">
            
                    
                    Customize Business Logic Contracts
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter active" data-level="2.4.1" data-path="Customizing Business Logic Contract.html">
            
                <a href="Customizing Business Logic Contract.html">
            
                    
                    Guidelines for Developing
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.4.2" data-path="launch.html">
            
                <a href="launch.html">
            
                    
                    Launch and Testing
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    
        
        <li class="header">Appendix</li>
        
        
    
        <li class="chapter " data-level="3.1" >
            
                <span>
            
                    
                    Contract
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.1.1" data-path="../../Core_Smart_Contract/Contract/MainNet.html">
            
                <a href="../../Core_Smart_Contract/Contract/MainNet.html">
            
                    
                    MainNet
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.2" data-path="../../Core_Smart_Contract/Contract/TestNet.html">
            
                <a href="../../Core_Smart_Contract/Contract/TestNet.html">
            
                    
                    TestNet
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.3" data-path="../../Core_Smart_Contract/Contract/DevNet.html">
            
                <a href="../../Core_Smart_Contract/Contract/DevNet.html">
            
                    
                    DevNet
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.2" >
            
                <span>
            
                    
                    Token
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.2.1" data-path="../../Core_Smart_Contract/Token/MainNet.html">
            
                <a href="../../Core_Smart_Contract/Token/MainNet.html">
            
                    
                    MainNet
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.2.2" data-path="../../Core_Smart_Contract/Token/TestNet.html">
            
                <a href="../../Core_Smart_Contract/Token/TestNet.html">
            
                    
                    TestNet
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.2.3" data-path="../../Core_Smart_Contract/Token/DevNet.html">
            
                <a href="../../Core_Smart_Contract/Token/DevNet.html">
            
                    
                    DevNet
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.3" data-path="../../Core_Smart_Contract/Relayer and Nodes/Poly-Relayer-Nodes.html">
            
                <a href="../../Core_Smart_Contract/Relayer and Nodes/Poly-Relayer-Nodes.html">
            
                    
                    Relayer and Nodes
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.4" data-path="../../GLOSSARY.html">
            
                <a href="../../GLOSSARY.html">
            
                    
                    Glossary
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">FAQ</li>
        
        
    
        <li class="chapter " data-level="4.1" data-path="../../FAQ/template.html">
            
                <a href="../../FAQ/template.html">
            
                    
                    FAQ
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


        </nav>
        
        
    </div>

    <!-- Content nav -->
    <div class="book-anchor">
        <!--<div class="book-anchor-title">在这篇文章中:</div>-->
        <div class="book-anchor-body">

        </div>
    </div>

    <div class="book-body">
        
        <div class="body-inner">
            
            

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../.." >Guidelines for Developing</a>
    </h1>
</div>




            <div class="page-wrapper" tabindex="-1" role="main">
                <div class="page-inner">
                    
<div id="book-search-results">
    <div class="search-noresults">
    
                    <section class="normal markdown-section">
                        
                        <h1 align="center" id="guidelines-for-developing">Guidelines for Developing</h1>

<h2 id="1-developing-customized-business-logic-contracts">1. Developing Customized Business Logic Contracts</h2>
<p>To implement cross chain features for any chain, cross chain management contract is needed to be deployed. Every chain can have no more than one management contract. All the business logic contracts need to interact with the CCM contract. Following is the detailed description of two interfaces offered by CCM contract. You may refer to the full <a href="https://github.com/polynetwork/eth-contracts/blob/master/contracts/core/cross_chain_manager/logic/EthCrossChainManager.sol" target="_blank">code</a> of CCM contract. </p>
<h3 id="step1-binding-the-mapping-relationship">Step1. Binding the Mapping Relationship</h3>
<p>Except for verifying the existence of transaction through CCM contract, business logic contract needs to make sure the accuracy of the assets relationship in the transaction. Therefore, the business contract should maintain both the asset mapping and business logic contract mapping. Asset hash is mapped from the <a href="../../GLOSSARY.html#source-chain" class="glossary-term" title="A public chain corresponds to the target chain where a particular asset firstly appears.">source chain</a> to the <a href="../../GLOSSARY.html#target-chain" class="glossary-term" title="A public chain corresponds to the source chain on which we want to cross an asset and issue a new token.">target chain</a>, and <a href="../../GLOSSARY.html#target-chain" class="glossary-term" title="A public chain corresponds to the source chain on which we want to cross an asset and issue a new token.">target chain</a> Id is mapped to the business logic contract address on <a href="../../GLOSSARY.html#target-chain" class="glossary-term" title="A public chain corresponds to the source chain on which we want to cross an asset and issue a new token.">target chain</a>.</p>
<h4 id="example">Example:</h4>
<p>The asset mapping relationship stored in business logic contract will help complete transaction data. Binding actions also prevent the wrong input from users which may lead to transfer assets to wrong asset contract address.</p>
<pre class="language-"><code class="lang-solidity"><span class="token keyword">pragma</span> <span class="token keyword">solidity</span> <span class="token operator">^</span><span class="token version number">0.5.0</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token string">&quot;./../../libs/ownership/Ownable.sol&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">contract</span> <span class="token class-name">LockProxy</span> <span class="token keyword">is</span> Ownable <span class="token punctuation">{</span>
    <span class="token builtin">address</span> <span class="token keyword">public</span> managerProxyContract<span class="token punctuation">;</span>
    <span class="token keyword">mapping</span><span class="token punctuation">(</span><span class="token builtin">uint64</span> <span class="token operator">=&gt;</span> <span class="token builtin">bytes</span><span class="token punctuation">)</span> <span class="token keyword">public</span> proxyHashMap<span class="token punctuation">;</span>
    <span class="token keyword">mapping</span><span class="token punctuation">(</span><span class="token builtin">address</span> <span class="token operator">=&gt;</span> <span class="token keyword">mapping</span><span class="token punctuation">(</span><span class="token builtin">uint64</span> <span class="token operator">=&gt;</span> <span class="token builtin">bytes</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">public</span> assetHashMap<span class="token punctuation">;</span>

    <span class="token comment">// toChainId: the target chain id</span>
    <span class="token comment">// targetProxyHash: the address of business logic contract on target chain</span>
    <span class="token keyword">function</span> <span class="token function">bindProxyHash</span><span class="token punctuation">(</span><span class="token builtin">uint64</span> toChainId<span class="token punctuation">,</span> <span class="token builtin">bytes</span> <span class="token keyword">memory</span> targetProxyHash<span class="token punctuation">)</span> onlyOwner <span class="token keyword">public</span> <span class="token keyword">returns</span> <span class="token punctuation">(</span><span class="token builtin">bool</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        proxyHashMap<span class="token punctuation">[</span>toChainId<span class="token punctuation">]</span> <span class="token operator">=</span> targetProxyHash<span class="token punctuation">;</span>
        <span class="token keyword">emit</span> <span class="token function">BindProxyEvent</span><span class="token punctuation">(</span>toChainId<span class="token punctuation">,</span> targetProxyHash<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// fromAssetHash: asset hash on source chain </span>
    <span class="token comment">// toAssetHash: asset hash on target chain</span>
    <span class="token keyword">function</span> <span class="token function">bindAssetHash</span><span class="token punctuation">(</span><span class="token builtin">address</span> fromAssetHash<span class="token punctuation">,</span> <span class="token builtin">uint64</span> toChainId<span class="token punctuation">,</span> <span class="token builtin">bytes</span> <span class="token keyword">memory</span> toAssetHash<span class="token punctuation">)</span> onlyOwner <span class="token keyword">public</span> <span class="token keyword">returns</span> <span class="token punctuation">(</span><span class="token builtin">bool</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        assetHashMap<span class="token punctuation">[</span>fromAssetHash<span class="token punctuation">]</span><span class="token punctuation">[</span>toChainId<span class="token punctuation">]</span> <span class="token operator">=</span> toAssetHash<span class="token punctuation">;</span>
        <span class="token keyword">emit</span> <span class="token function">BindAssetEvent</span><span class="token punctuation">(</span>fromAssetHash<span class="token punctuation">,</span> toChainId<span class="token punctuation">,</span> toAssetHash<span class="token punctuation">,</span> <span class="token function">getBalanceFor</span><span class="token punctuation">(</span>fromAssetHash<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h3 id="step2-initiating-a-cross-chain-request-from-the-source-chain">Step2. Initiating a Cross-chain Request from the Source Chain</h3>
<h4 id="interface">Interface:</h4>
<pre class="language-"><code class="lang-solidity"><span class="token comment">/*  
 *  @param toChainId              The target chain id
 *  @param toAddress              The address in bytes format to receive same amount of tokens in target chain
 *  @param toContract             Target smart contract address in bytes in target block chain
 *  @param txData                 Transaction data for target chain, include toAssetHash, toAddress, amount
 *  @return                       true or false 
*/</span>
<span class="token keyword">function</span> <span class="token function">crossChain</span><span class="token punctuation">(</span><span class="token builtin">uint64</span> toChainId<span class="token punctuation">,</span> <span class="token builtin">bytes</span> <span class="token keyword">calldata</span> toContract<span class="token punctuation">,</span> <span class="token builtin">bytes</span> <span class="token keyword">calldata</span> method<span class="token punctuation">,</span> <span class="token builtin">bytes</span> <span class="token keyword">calldata</span> txData<span class="token punctuation">)</span> whenNotPaused <span class="token keyword">external</span> <span class="token keyword">returns</span> <span class="token punctuation">(</span><span class="token builtin">bool</span><span class="token punctuation">)</span>
</code></pre>
<ul>
<li>This method creates cross chain transactions, invoked by service contracts when a cross chain function is carried out in the logic contract.</li>
<li>This method constructs the <code>rawParam</code>, which contains transaction hash, <code>msg.sender</code>, <a href="../../GLOSSARY.html#target-chain" class="glossary-term" title="A public chain corresponds to the source chain on which we want to cross an asset and issue a new token.">target chain</a> id, business logic contract to be invoked on <a href="../../GLOSSARY.html#target-chain" class="glossary-term" title="A public chain corresponds to the source chain on which we want to cross an asset and issue a new token.">target chain</a>, the target method to be invoked and the serialized transaction data which has been already constructed in business logic contract. </li>
<li>Then put the hash of <code>rawParam</code> into storage, to help provide proof of transaction existence.</li>
</ul>
<h4 id="example-of-calling-the-interface-crosschain">Example of Calling the Interface <code>crossChain()</code>:</h4>
<pre class="language-"><code class="lang-solidity"><span class="token comment">/*  
 *  @param fromAssetHash     The asset address in current chain
 *  @param toChainId         The target chain id
 *  @param toAddress         The address in bytes format to receive same amount of tokens in target chain 
 *  @param amount            The amount of tokens to be crossed from ethereum to the chain with chainId
*/</span>
<span class="token keyword">function</span> <span class="token function">lock</span><span class="token punctuation">(</span><span class="token builtin">address</span> fromAssetHash<span class="token punctuation">,</span> <span class="token builtin">uint64</span> toChainId<span class="token punctuation">,</span> <span class="token builtin">bytes</span> <span class="token keyword">memory</span> toAddress<span class="token punctuation">,</span> <span class="token builtin">uint256</span> amount<span class="token punctuation">)</span> <span class="token keyword">public</span> <span class="token keyword">payable</span> <span class="token keyword">returns</span> <span class="token punctuation">(</span><span class="token builtin">bool</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">require</span><span class="token punctuation">(</span>amount <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">&quot;amount cannot be zero!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">require</span><span class="token punctuation">(</span><span class="token function">_transferToContract</span><span class="token punctuation">(</span>fromAssetHash<span class="token punctuation">,</span> amount<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;transfer asset from fromAddress to lock_proxy contract failed!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token builtin">bytes</span> <span class="token keyword">memory</span> toAssetHash <span class="token operator">=</span> assetHashMap<span class="token punctuation">[</span>fromAssetHash<span class="token punctuation">]</span><span class="token punctuation">[</span>toChainId<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">require</span><span class="token punctuation">(</span>toAssetHash<span class="token punctuation">.</span>length <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">&quot;empty illegal toAssetHash&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    TxArgs <span class="token keyword">memory</span> txArgs <span class="token operator">=</span> <span class="token function">TxArgs</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        toAssetHash<span class="token punctuation">:</span> toAssetHash<span class="token punctuation">,</span>
        toAddress<span class="token punctuation">:</span> toAddress<span class="token punctuation">,</span>
        amount<span class="token punctuation">:</span> amount
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token builtin">bytes</span> <span class="token keyword">memory</span> txData <span class="token operator">=</span> <span class="token function">_serializeTxArgs</span><span class="token punctuation">(</span>txArgs<span class="token punctuation">)</span><span class="token punctuation">;</span>

    IEthCrossChainManagerProxy eccmp <span class="token operator">=</span> <span class="token function">IEthCrossChainManagerProxy</span><span class="token punctuation">(</span>managerProxyContract<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token builtin">address</span> eccmAddr <span class="token operator">=</span> eccmp<span class="token punctuation">.</span><span class="token function">getEthCrossChainManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    IEthCrossChainManager eccm <span class="token operator">=</span> <span class="token function">IEthCrossChainManager</span><span class="token punctuation">(</span>eccmAddr<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token builtin">bytes</span> <span class="token keyword">memory</span> toProxyHash <span class="token operator">=</span> proxyHashMap<span class="token punctuation">[</span>toChainId<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">require</span><span class="token punctuation">(</span>toProxyHash<span class="token punctuation">.</span>length <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">&quot;empty illegal toProxyHash&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">require</span><span class="token punctuation">(</span>eccm<span class="token punctuation">.</span><span class="token function">crossChain</span><span class="token punctuation">(</span>toChainId<span class="token punctuation">,</span> toProxyHash<span class="token punctuation">,</span> <span class="token string">&quot;unlock&quot;</span><span class="token punctuation">,</span> txData<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;EthCrossChainManager crossChain executed error!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">emit</span> <span class="token function">LockEvent</span><span class="token punctuation">(</span>fromAssetHash<span class="token punctuation">,</span> <span class="token function">_msgSender</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> toChainId<span class="token punctuation">,</span> toAssetHash<span class="token punctuation">,</span> toAddress<span class="token punctuation">,</span> amount<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre>
<ul>
<li>This function is meant to be invoked by the user. The user requests an asset token cross chain transaction through the dApp which works in <a href="../../GLOSSARY.html#source-chain" class="glossary-term" title="A public chain corresponds to the target chain where a particular asset firstly appears.">source chain</a>, business logic contract gets the transaction information which contains the asset contract address on <a href="../../GLOSSARY.html#source-chain" class="glossary-term" title="A public chain corresponds to the target chain where a particular asset firstly appears.">source chain</a>, the <a href="../../GLOSSARY.html#target-chain" class="glossary-term" title="A public chain corresponds to the source chain on which we want to cross an asset and issue a new token.">target chain</a> id, the target address and amount of token to be transfered. By calling this method, business logic contract will lock the certain amount to asset contract;</li>
<li>Then the transaction data will be packed, which then in turn invokes the CCM contract. The management contract transfers the parameters of transaction data to the <a href="../../GLOSSARY.html#target-chain" class="glossary-term" title="A public chain corresponds to the source chain on which we want to cross an asset and issue a new token.">target chain</a> and a cross chain transaction is created by management contract which is sent to the <a href="../../GLOSSARY.html#target-chain" class="glossary-term" title="A public chain corresponds to the source chain on which we want to cross an asset and issue a new token.">target chain</a> based on block generation on <a href="../../GLOSSARY.html#source-chain" class="glossary-term" title="A public chain corresponds to the target chain where a particular asset firstly appears.">source chain</a>;</li>
<li>The serialized transaction data, along with the chain id and business logic contract address of <a href="../../GLOSSARY.html#target-chain" class="glossary-term" title="A public chain corresponds to the source chain on which we want to cross an asset and issue a new token.">target chain</a> and the method needed to be called on <a href="../../GLOSSARY.html#target-chain" class="glossary-term" title="A public chain corresponds to the source chain on which we want to cross an asset and issue a new token.">target chain</a>, will be sent through <code>crossChain()</code> in CCM contract.</li>
</ul>
<h3 id="step3-verifying-and-executing-cross-chain-transaction-on-the-target-chain">Step3. Verifying and Executing Cross Chain Transaction on the Target Chain</h3>
<h4 id="interface">Interface:</h4>
<pre class="language-"><code class="lang-solidity"><span class="token comment">/*  
 *  @param proof                  Poly chain transaction merkle proof
 *  @param rawHeader              The header containing crossStateRoot to verify the above tx merkle proof
 *  @param headerProof            The header merkle proof used to verify rawHeader
 *  @param curRawHeader           Any header in current epoch consensus of Poly chain
 *  @param headerSig              The coverted signature veriable for solidity derived from Poly chain consensus nodes&apos; signature 
 *                                used to verify the validity of curRawHeader
 *  @return                       true or false
*/</span>
<span class="token keyword">function</span> <span class="token function">verifyHeaderAndExecuteTx</span><span class="token punctuation">(</span><span class="token builtin">bytes</span> <span class="token keyword">memory</span> proof<span class="token punctuation">,</span> <span class="token builtin">bytes</span> <span class="token keyword">memory</span> rawHeader<span class="token punctuation">,</span> <span class="token builtin">bytes</span> <span class="token keyword">memory</span> headerProof<span class="token punctuation">,</span> <span class="token builtin">bytes</span> <span class="token keyword">memory</span> curRawHeader<span class="token punctuation">,</span> <span class="token builtin">bytes</span> <span class="token keyword">memory</span> headerSig<span class="token punctuation">)</span> whenNotPaused <span class="token keyword">public</span> <span class="token keyword">returns</span> <span class="token punctuation">(</span><span class="token builtin">bool</span><span class="token punctuation">)</span>
</code></pre>
<ul>
<li>This method is meant to be invoked by <a href="../../GLOSSARY.html#relayer" class="glossary-term" title="A cross-chain information porter performs some of the most critical operations within the cross-chain. It acts as the medium of interaction between the side chain and the outside world.">relayer</a>, in some cases user could invoke this method by themselves if they get the valid block information from Poly. </li>
<li>This method fetches and processes cross chain transactions, finds the merkle root of a transaction based on the block height (in the block header), and verifies the legitimacy of transaction using the transaction parameters.</li>
<li>After verifying <a href="../../GLOSSARY.html#poly-chain" class="glossary-term" title="The Relay chain in the cross-chain ecosystem. One of the crucial components of the cross-chain ecosystem. Each type of node is deployed and maintained by other individuals or organizations and has its unique governance and trust mechanism. The relay chain is responsible for connecting them, standardizing cross-chain data flow and interfaces, verifying the legitimacy of cross-chain data, etc.">Poly chain</a> block header and proof, it will invoke the business logic contract deployed on the <a href="../../GLOSSARY.html#target-chain" class="glossary-term" title="A public chain corresponds to the source chain on which we want to cross an asset and issue a new token.">target chain</a>. Invoking will be processed through the internal method <code>_executeCrossChainTx()</code>: <ul>
<li>This method is meant to invoke the target contract, and trigger executation of cross chain tx on <a href="../../GLOSSARY.html#target-chain" class="glossary-term" title="A public chain corresponds to the source chain on which we want to cross an asset and issue a new token.">target chain</a>. Firstly, we need to ensure the target contract gonna be invoked is indeed a contract rather than a normal account address. </li>
<li>Then we construct a method calling on target business logic contract: first we need to <code>encodePacked</code> the <code>_method</code> and the format of input data <code>&quot;(bytes,bytes,uint64)&quot;</code>. Then it would <code>keccak256</code> the encoded string, use <code>bytes4</code> to take the first four bytes of the call data for a function call specifies the function to be called. Parameter <code>_method</code>  is from the <code>toMerkleValue</code> , which is parsed from <code>proof</code>. And the input parameters format is restricted as (bytes <code>_args</code>, bytes <code>_fromContractAddr</code>, uint64 <code>_fromChainId</code>). These two parts are encodePacked as a method call.  </li>
<li>After calling the method, we need to check the return value. Only if the return value is true, will the whole cross chain transaction be executed successfully. </li>
</ul>
</li>
</ul>
<h4 id="example-of-calling-the-interface-verifyheaderandexecutetx">Example of Calling the Interface <code>verifyHeaderAndExecuteTx()</code>:</h4>
<pre class="language-"><code class="lang-solidity"><span class="token comment">/*  
 *  @param argsBs            The argument bytes recevied by the lock proxy contract on source chain, 
 *                           need to be deserialized based on the way of serialization in the 
 *                           lock proxy contract on source chain .
 *  @param fromContractAddr  The source chain contract address
 *  @param fromChainId       The source chain id
*/</span>
<span class="token keyword">function</span> <span class="token function">unlock</span><span class="token punctuation">(</span><span class="token builtin">bytes</span> <span class="token keyword">memory</span> argsBs<span class="token punctuation">,</span> <span class="token builtin">bytes</span> <span class="token keyword">memory</span> fromContractAddr<span class="token punctuation">,</span> <span class="token builtin">uint64</span> fromChainId<span class="token punctuation">)</span> onlyManagerContract <span class="token keyword">public</span> <span class="token keyword">returns</span> <span class="token punctuation">(</span><span class="token builtin">bool</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    TxArgs <span class="token keyword">memory</span> args <span class="token operator">=</span> <span class="token function">_deserializeTxArgs</span><span class="token punctuation">(</span>argsBs<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">require</span><span class="token punctuation">(</span>fromContractAddr<span class="token punctuation">.</span>length <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">&quot;from proxy contract address cannot be empty&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">require</span><span class="token punctuation">(</span>Utils<span class="token punctuation">.</span><span class="token function">equalStorage</span><span class="token punctuation">(</span>proxyHashMap<span class="token punctuation">[</span>fromChainId<span class="token punctuation">]</span><span class="token punctuation">,</span> fromContractAddr<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;From Proxy contract address error!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">require</span><span class="token punctuation">(</span>args<span class="token punctuation">.</span>toAssetHash<span class="token punctuation">.</span>length <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">&quot;toAssetHash cannot be empty&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token builtin">address</span> toAssetHash <span class="token operator">=</span> Utils<span class="token punctuation">.</span><span class="token function">bytesToAddress</span><span class="token punctuation">(</span>args<span class="token punctuation">.</span>toAssetHash<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">require</span><span class="token punctuation">(</span>args<span class="token punctuation">.</span>toAddress<span class="token punctuation">.</span>length <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">&quot;toAddress cannot be empty&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token builtin">address</span> toAddress <span class="token operator">=</span> Utils<span class="token punctuation">.</span><span class="token function">bytesToAddress</span><span class="token punctuation">(</span>args<span class="token punctuation">.</span>toAddress<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">require</span><span class="token punctuation">(</span><span class="token function">_transferFromContract</span><span class="token punctuation">(</span>toAssetHash<span class="token punctuation">,</span> toAddress<span class="token punctuation">,</span> args<span class="token punctuation">.</span>amount<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;transfer asset from lock_proxy contract to toAddress failed!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">emit</span> <span class="token function">UnlockEvent</span><span class="token punctuation">(</span>toAssetHash<span class="token punctuation">,</span> toAddress<span class="token punctuation">,</span> args<span class="token punctuation">.</span>amount<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<ul>
<li>This functions is meant to be invoked by CCM contract. It deserializes the transaction data and invokes the asset contract to release the tokens to target address.</li>
<li><code>verifyHeaderAndExecuteTx()</code> in CCM contract determines the legitimacy of the cross chain transaction information and resolve the parameters of transaction data from the <a href="../../GLOSSARY.html#poly-chain" class="glossary-term" title="The Relay chain in the cross-chain ecosystem. One of the crucial components of the cross-chain ecosystem. Each type of node is deployed and maintained by other individuals or organizations and has its unique governance and trust mechanism. The relay chain is responsible for connecting them, standardizing cross-chain data flow and interfaces, verifying the legitimacy of cross-chain data, etc.">Poly chain</a> transaction merkle proof and <code>crossStateRoot</code> contained in the block header. After verification through Poly, the packed transaction data could be executed on <a href="../../GLOSSARY.html#target-chain" class="glossary-term" title="A public chain corresponds to the source chain on which we want to cross an asset and issue a new token.">target chain</a>.</li>
<li>Then call the function <code>unlock()</code> to deserialize the transaction data and unlock (transfer) the certain amount of token to the target address on <a href="../../GLOSSARY.html#target-chain" class="glossary-term" title="A public chain corresponds to the source chain on which we want to cross an asset and issue a new token.">target chain</a> and completes the cross chain contract invocation.</li>
</ul>
<h2 id="2-deploying-contracts">2. Deploying Contracts</h2>
<p>To realize implementation of cross chain features, developers need to make sure that:</p>
<ul>
<li>The customized business logic contracts are deployed both on <a href="../../GLOSSARY.html#source-chain" class="glossary-term" title="A public chain corresponds to the target chain where a particular asset firstly appears.">source chain</a> and <a href="../../GLOSSARY.html#target-chain" class="glossary-term" title="A public chain corresponds to the source chain on which we want to cross an asset and issue a new token.">target chain</a></li>
<li>The cross chain methods in your business logic contracts should allow our Cross Chain Manager Contract to call</li>
<li>The mapping assets need to be bound before any cross chain transactions</li>
</ul>
<h2 id="3-testing-your-contracts">3. Testing Your Contracts</h2>
<p>We highly encourage project developers to test the business logic contract on testnet before launching on mainnet. If you want to test your contract on mainnet directly, you need to provide us with the business logic contract addresses and cross-chain methods both on <a href="../../GLOSSARY.html#source-chain" class="glossary-term" title="A public chain corresponds to the target chain where a particular asset firstly appears.">source chain</a> and <a href="../../GLOSSARY.html#target-chain" class="glossary-term" title="A public chain corresponds to the source chain on which we want to cross an asset and issue a new token.">target chain</a>, so that we could maintain the whitelist of CCM contract, which is meant to guarantee the safety of cross chain process. </p>
<p>Following are the tests required to be done before launching project:</p>
<ul>
<li></li>
</ul>
<footer class="page-footer"><span class="copyright">Copyright &#xA9; 2022 PolyNetwork. All right reserved.</span><span class="footer-modification">Last modification date&#xFF1A;
2022-02-10 17:04:26
</span></footer>
                        
                    </section>
                    
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                </div>
            </div>
            
        </div>

        
        
        <a href="readme.html"
           class="navigation navigation-prev "
           aria-label="Previous page: Customize Business Logic Contracts">
            <i class="fa fa-angle-left"></i>
        </a>
        
        
        <a href="launch.html"
           class="navigation navigation-next "
           aria-label="Next page: Launch and Testing">
            <i class="fa fa-angle-right"></i>
        </a>
        
        
        
    </div>
    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Guidelines for Developing","level":"2.4.1","depth":2,"next":{"title":"Launch and Testing","level":"2.4.2","depth":2,"path":"new_product/integrate_contracts/launch.md","ref":"new_product/integrate_contracts/launch.md","articles":[]},"previous":{"title":"Customize Business Logic Contracts","level":"2.4","depth":1,"path":"new_product/integrate_contracts/readme.md","ref":"new_product/integrate_contracts/readme.md","articles":[{"title":"Guidelines for Developing","level":"2.4.1","depth":2,"path":"new_product/integrate_contracts/Customizing Business Logic Contract.md","ref":"new_product/integrate_contracts/Customizing Business Logic Contract.md","articles":[]},{"title":"Launch and Testing","level":"2.4.2","depth":2,"path":"new_product/integrate_contracts/launch.md","ref":"new_product/integrate_contracts/launch.md","articles":[]}]},"dir":"ltr"},"config":{"plugins":["-sharing","sharing-plus","theme-hqbook","flexible-linkcard","emphasize","flexible-alerts","lightbox","alerts","expandable-chapters","custom-favicon","tbfed-pagefooter","hide-element","-lunr","-search","search-pro","code","heading-anchors","-highlight","prism","prism-themes","livereload"],"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"tbfed-pagefooter":{"copyright":"Copyright &copy 2022 PolyNetwork.","modify_label":"Last modification date：","modify_format":"YYYY-MM-DD HH:mm:ss"},"prism":{"css":["prismjs/themes/prism-okaidia.css"]},"emphasize":{},"livereload":{},"search-pro":{},"sharing-plus":{"qq":false,"all":["facebook","google","twitter","instapaper","linkedin","pocket","stumbleupon"],"douban":false,"facebook":true,"weibo":false,"instapaper":false,"whatsapp":false,"hatenaBookmark":false,"twitter":true,"messenger":false,"line":false,"vk":false,"pocket":true,"google":false,"viber":false,"stumbleupon":false,"qzone":false,"linkedin":false},"flexible-linkcard":{"hrefUrl":"../../demo/demo.html","imgClass":"","imgSrc":"../../images/home/logo.png","target":"_blank","title":"Converts blockquotes into beautiful linkcard, custom nice links"},"code":{"copyButtons":true},"hide-element":{"elements":[".gitbook-link"]},"fontsettings":{"theme":"white","family":"sans","size":2},"heading-anchors":{},"favicon":"resources/favicon.ico","lightbox":{"jquery":true,"sameUuid":false},"prism-themes":{},"theme-hqbook":{"copyButtons":false,"copyLines":true,"dragSplitter":true,"favicon":"./favicon.ico","flexible-linkcard":{"hrefUrl":"https://poly.network/#/","imgClass":"rect","imgSrc":"/resources/logo.png","target":"_blank","title":"flexible-linkcard"},"logo":"/resources/logo.png","search-placeholder":"Search...","hide-elements":[".summary .gitbook-link"]},"alerts":{},"custom-favicon":{},"flexible-alerts":{"danger":{"className":"danger","icon":"fa fa-ban","label":"Attention"},"note":{"className":"info","icon":"fa fa-info-circle","label":"Note"},"style":"callout","tip":{"className":"tip","icon":"fa fa-lightbulb-o","label":"Tip"},"warning":{"className":"warning","icon":"fa fa-exclamation-triangle","label":"Warning"}},"links":{"sidebar":{"Blog":"https://blog.csdn.net/ming_97y","Github":"https://github.com/jiangminggithub"}},"sharing":{"qq":false,"telegram":true,"youtube":true,"github":true,"douban":false,"facebook":false,"weibo":false,"discord":true,"instapaper":false,"whatsapp":false,"hatenaBookmark":false,"twitter":true,"messenger":false,"line":false,"vk":false,"medium":true,"pocket":false,"google":false,"viber":false,"stumbleupon":false,"email":true,"qzone":false,"linkedin":false},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false},"expandable-chapters":{}},"theme":"default","author":"PolyNetwork","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"introduction.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"lightbox":{"includeJQuery":false,"sameUuid":true,"options":{"resizeDuration":500,"wrapAround":false}},"variables":{"themeHqbook":{"nav":[{"url":"https://poly.network/","target":"_blank","name":"Home"},{"url":"https://bridge.poly.network/","target":"_blank","name":"Poly Bridge"},{"url":"https://explorer.poly.network/","target":"_blank","name":"Poly Explorer"}]}},"title":"","flexible-alerts":{"style":"callout","comment":{"label":"Comment","icon":"fa fa-comments","className":"info"}},"gitbook":"*","theme-default":{"showLevel":true}},"file":{"path":"new_product/integrate_contracts/Customizing Business Logic Contract.md","mtime":"2022-02-10T09:04:26.660Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2022-02-11T02:31:46.990Z"},"basePath":"../..","book":{"language":""}})
        });
    </script>
</div>

        
    <script src="../../gitbook/gitbook.js"></script>
    <script src="../../gitbook/theme.js"></script>
    
        
        <script src="../../gitbook/gitbook-plugin-sharing-plus/buttons.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-flexible-linkcard/flexible-linkcard.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-flexible-alerts/plugin.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-lightbox/js/lightbox.min.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-alerts/plugin.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-expandable-chapters/expandable-chapters.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-hide-element/plugin.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-search-pro/jquery.mark.min.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-search-pro/search.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-code/plugin.js"></script>
        
    
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/1.2.1/anchor.min.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-heading-anchors/anchor-style.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-livereload/plugin.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-theme-hqbook/theme.js"></script>
        
    

    </body>
</html>

